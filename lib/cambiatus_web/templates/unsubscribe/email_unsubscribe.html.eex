<!DOCTYPE html>
<html>

<% import CambiatusWeb.Gettext %>
    <% Gettext.put_locale(CambiatusWeb.Gettext, Atom.to_string(@data.language)) %>

        <head>
            <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
            <title>Cambiatus</title>
            <meta name="viewport" content="width=device-width, initial-scale=1.0" />

            <style>
                .switch {
                    position: relative;
                    display: inline-block;
                    width: 46px;
                    height: 22px;
                }

                .switch input {
                    opacity: 0;
                    width: 0;
                    height: 0;
                }

                .switch-label {
                    text-align: left;
                    margin-left: -70px;
                    position: absolute;
                    top: -18px;
                }

                .switch-label:before {
                    margin-left: -70px;
                    position: absolute;
                    top: -14px;
                    color: #5C5C5C;
                }

                .slider {
                    position: absolute;
                    cursor: pointer;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background-color: #FFFFFF;
                    -webkit-transition: .4s;
                    transition: .4s;
                }

                .slider:before {
                    position: absolute;
                    content: "";
                    height: 18px;
                    width: 18px;
                    left: 2px;
                    bottom: 2px;
                    background-color: #5C5C5C;
                    -webkit-transition: .2s;
                    transition: .2s;
                }

                input:checked+.slider {
                    background-color: #45469B;
                }

                input:focus+.slider {
                    box-shadow: 0 0 1px #F8F8F8;
                }

                input:checked+.slider:before {
                    -webkit-transform: translateX(24px);
                    -ms-transform: translateX(24px);
                    transform: translateX(24px);
                    background-color: white;
                }

                input:checked+.switch-label:before {
                    -webkit-transform: translateX(12px);
                    -ms-transform: translateX(12px);
                    transform: translateX(12px);
                    background-color: white;
                }

                .slider.round {
                    border-radius: 19px;
                }

                .slider.round:before {
                    border-radius: 50%;
                }

                .row {
                    width: 600px;
                    min-width: 80px;
                    height: 60px;
                    line-height: 60px;
                    background-color: #F8F8F8;
                    border-bottom: 1px solid #E7E7E7;
                }

                .bottom-row {
                    width: 600px;
                    min-width: 80px;
                    height: 60px;
                    line-height: 60px;
                    background-color: #F8F8F8;
                }


                .ul {
                    list-style-type: none;
                    margin: 5px;
                    padding: 5px;
                    overflow: hidden;
                }

                .flexing {
                    display: flex;
                    flex-direction: row;
                    justify-content: space-between;
                    align-items: center;
                }

                .form {
                    display: flex;
                    flex-direction: column;
                    justify-content: space-between;
                    align-items: center;
                }

                .bg {
                    background-color: #F8F8F8;
                    padding-left: 25px;
                    padding-right: 25px;
                    font: 14px 'nunito', sans-serif;
                    border-radius: 20px;
                }

                .button-style {
                    margin: 0;
                    position: absolute;
                    left: 50%;
                    -ms-transform: translate(-50%, -50%);
                    transform: translate(-50%, -50%);
                    background-color: #F99D33;
                    height: 40px;
                    border: none;
                    color: white;
                    padding-left: 20px;
                    padding-right: 20px;
                    text-align: center;
                    text-decoration: none;
                    display: inline-block;
                    font-size: 16px;
                    border-radius: 24px;
                }

                .button-style:hover {
                    background-color: #FAB15C;
                    color: white;
                }
            </style>
        </head>

        <body style="margin: 0; padding: 0;">
            <h1 style="text-align: center;">
                <%= gettext("Which mailing list do you wisth to unsubscribe?") %>
            </h1>
            <form class="form" action="/api/graph" method="post">
                <div class="bg">
                    <ul class="ul">
                        <li class="row">
                            <div class="flexing">
                                <span>
                                    <%= gettext("News Digest") %>
                                </span>
                                <div class="flexing">
                                    <label class="switch">
                                        <div class="switch-label">
                                            <%= gettext("disabled") %>
                                        </div>
                                        <input type="checkbox" id="digest" class="switch" />
                                        <span class="slider round"></span>
                                </div>
                                </label>
                            </div>
                        </li>
                        <li class="row">
                            <div class="flexing">
                                <span>
                                    <%= gettext("Claims Notifications") %>
                                </span>
                                <div class="flexing">
                                    <label class="switch">
                                        <div class="switch-label">
                                            <%= gettext("disabled") %>
                                        </div>
                                        <input type="checkbox" id="claims" class="switch" />
                                        <span class="slider round"></span>
                                </div>
                                </label>
                            </div>
                        </li>
                        <li class="bottom-row">
                            <div class="flexing">
                                <span>
                                    <%= gettext("Transfer Notifications") %>
                                </span>
                                <div class="flexing">
                                    <label class="switch">
                                        <div class="switch-label">
                                            <%= gettext("disabled") %>
                                        </div>
                                        <input type="checkbox" id="transfers" class="switch" />
                                        <span class="slider round"></span>
                                </div>
                                </label>
                            </div>
                        </li>
                        <li style="height=80px; line-height: 80px;">
                            <button class="button-style" type="button" onclick="emailUnsubscribe()">
                                <%= gettext("Submit") %>
                            </button>
                        <li>
                    </ul>
                </div>
            </form>

            <script>
                function emailUnsubscribe() {
                    const digest = document.getElementById('digest').checked;
                    const claims = document.getElementById('claims').checked;
                    const transfers = document.getElementById('transfers').checked;

                    if (digest == false && claims == false && transfers == false) {
                        return alert("<%= gettext("You must select at least one mailing list to unsubscribe from.") %>");
                    };

                    var body = "";
                    if (digest) {
                        body += "digest: false "
                    };
                    if (claims) {
                        body += "claimNotification: false "
                    };
                    if (transfers) {
                        body += "transferNotification: false"
                    };

                    var xhr = new XMLHttpRequest();
                    xhr.open('POST', '/api/graph', true);
                    xhr.setRequestHeader('Content-Type', 'application/json');
                    xhr.setRequestHeader('Authorization', 'Bearer ' + '<%= @data.token %>');
                    xhr.send(JSON.stringify({
                        query: "mutation {preference(" + body + ") {account}} "
                    }));
                };
            </script>
        </body>


</html>
